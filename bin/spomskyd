#!/usr/bin/env ruby
# vim: noet

begin

	# if this file is a symlink (which is probably is, since rubygems
	# symlinks bin files into /usr/bin), find the original source file
	this_file = File.symlink?(__FILE__) ? \
		File.readlink(__FILE__) : __FILE__
	
	# try loading the lib via a relative path
	# first, in case we're running on the trunk
	dev_path = File.expand_path(File.dirname(this_file) + "/../lib/spomskyd.rb")
	require File.expand_path(dev_path)
	
rescue LoadError
	begin
	
		# couldn't load via relative
		# path, so try loading the gem
		require "rubygems"
		require "spomskyd"
	end
end

# pass the arguments straight on to rubysms, tucked inside an array to
# indicate that we only want a single backend. this is rather obscure
# usage, but allows super (undocumented!) flexibility
if(ARGV.length > 0)
	SpomskyApp.serve!(ARGV)
	
else
	puts "Usage: spomskyd BACKEND [ARGUMENTS]"
	puts "  To start local development"
	puts "  mode, try `spomskyd HTTP`"
end
